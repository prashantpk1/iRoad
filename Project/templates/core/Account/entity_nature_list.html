{% extends 'extends/base.html' %}

{% block title %}Entity Nature List | Admin{% endblock %}

{% block content %}
<div class="container mt-4">

    <div class="d-flex justify-content-between mb-3">
        <h4>Entity Nature List</h4>
        <a href="{% url 'entity_nature_create' %}" class="btn btn-primary">Add</a>
    </div>

    <table id="entityNatureTable" class="table table-bordered table-striped">
        <thead>
            <tr>
                <th data-col="0">Entity Nature Label (Arabic) </th>
                <th data-col="1">Entity Nature Code </th>
                <th data-col="2">Entity Nature Label (English) </th>
                <th data-col="3">Entity Nature Type </th>
                <th data-col="4">Entity Nature Nationality </th>
                <th data-col="5">Entity Nature Residency </th>
                <th data-col="6">Entity Nature Status </th>
                <th>Action</th>
            </tr>
        </thead>

        <tbody>
            {% for entity in entity_natures %}
            <tr>
                <td>{{ entity.entity_nature_label_arabic }}</td>
                <td>{{ entity.entity_nature_code }}</td>
                <td>{{ entity.entity_nature_label_english }}</td>
                <td>{{ entity.entity_nature_type }}</td>
                <td>{{ entity.entity_nature_nationality }}</td>
                <td>{{ entity.entity_nature_residency }}</td>
                <td>{{ entity.entity_nature_status }}</td>
                <td>
                    <a href="{% url 'entity_nature_edit' entity.id %}"
                       class="btn btn-sm btn-warning">
                        Edit
                    </a>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="8" class="text-center">No records found</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

</div>

<!-- COLUMN DROPDOWN MENU -->
<div id="columnMenu"
     class="dropdown-menu p-3 shadow"
     style="position:absolute; display:none; z-index:9999; width:220px;">

    <input type="text"
           id="colSearch"
           class="form-control mb-2"
           placeholder="Search">

    <button class="btn btn-sm btn-outline-primary w-100 mb-1" id="sortAsc">
        Sort Ascending
    </button>

    <button class="btn btn-sm btn-outline-primary w-100 mb-1" id="sortDesc">
        Sort Descending
    </button>

    <button class="btn btn-sm btn-outline-secondary w-100" id="hideCol">
        Hide Column
    </button>
</div>
{% endblock %}

{% block js %}
<script>
let table;
let selectedColumn = null;

$(document).ready(function () {

    // Initialize DataTable (sorting ENABLED but header click DISABLED)
    table = $('#entityNatureTable').DataTable({
        paging: false,
        searching: false,
        ordering: true,
        info: false,
        columnDefs: [
            { orderable: false, targets: 7 } // Action column
        ]
    });

    // Disable default DataTables header click sorting
    $('#entityNatureTable thead th').off('click.DT');

    // Open dropdown when clicking column header
    $('#entityNatureTable thead th[data-col]').on('click', function (e) {
        e.stopPropagation();

        selectedColumn = $(this).data('col');

        $('#columnMenu').css({
            top: e.pageY + 5,
            left: e.pageX + 5
        }).show();

        $('#colSearch').val('');
    });

    // Close dropdown when clicking outside
    $(document).on('click', function () {
        $('#columnMenu').hide();
    });

    // Column search
    $('#colSearch').on('keyup', function () {
        table.column(selectedColumn).search(this.value).draw();
    });

    // Sort ascending
    $('#sortAsc').on('click', function () {
        table.order([selectedColumn, 'asc']).draw();
    });

    // Sort descending
    $('#sortDesc').on('click', function () {
        table.order([selectedColumn, 'desc']).draw();
    });

    // Hide column
    $('#hideCol').on('click', function () {
        table.column(selectedColumn).visible(false);
        $('#columnMenu').hide();
    });

});
</script>
{% endblock js %}
