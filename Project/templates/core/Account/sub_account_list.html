{% extends 'extends/base.html' %}

{% block title %}Sub Account List | Admin{% endblock %}

{% block content %}
<div class="container mt-4">

    <div class="d-flex justify-content-between mb-3">
        <h4>Sub Account List</h4>
        <a href="{% url 'sub_account_create' %}" class="btn btn-primary">Add</a>
    </div>

    <table id="entitysubaccountTable" class="table table-bordered table-striped">
        <thead>
            <tr>
                <th data-col="0">Code ▾</th>
                <th data-col="1">Arabic Label ▾</th>
                <th data-col="2">English Label ▾</th>
                <th data-col="3">Is Enable ▾</th>
                <th data-col="4">Account Purpose ▾</th>
                <th>Action</th>
            </tr>
        </thead>

        <tbody>
            {% for entity in sub_accounts %}
            <tr>
                <td>{{ entity.type_code }}</td>
                <td>{{ entity.arabic_label }}</td>
                <td>{{ entity.english_label }}</td>
                <td>{{ entity.is_enabled }}</td>
                <td>{{ entity.account_purpose }}</td>
                <td>
                    <a href="{% url 'sub_account_edit' entity.id %}"
                       class="btn btn-sm btn-warning">
                        Edit
                    </a>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="6" class="text-center">No records found</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

</div>

<!-- COLUMN DROPDOWN MENU -->
<div id="columnMenu"
     class="dropdown-menu p-3 shadow"
     style="position:absolute; display:none; z-index:9999; width:220px;">

    <input type="text"
           id="colSearch"
           class="form-control mb-2"
           placeholder="Search">

    <button class="btn btn-sm btn-outline-primary w-100 mb-1" id="sortAsc">
        Sort Ascending
    </button>

    <button class="btn btn-sm btn-outline-primary w-100 mb-1" id="sortDesc">
        Sort Descending
    </button>

    <button class="btn btn-sm btn-outline-secondary w-100" id="hideCol">
        Hide Column
    </button>
</div>
{% endblock %}

{% block js %}
<script>
let table;
let selectedColumn = null;

$(document).ready(function () {

    table = $('#entitysubaccountTable').DataTable({
        paging: false,
        searching: false,
        ordering: true,   // REQUIRED
        info: false,
        columnDefs: [
            { orderable: false, targets: 5 } // ✅ Action column FIXED
        ]
    });

    // Disable default DataTables header sorting
    $('#entitysubaccountTable thead th').off('click.DT');

    // Open dropdown on column click
    $('#entitysubaccountTable thead th[data-col]').on('click', function (e) {
        e.stopPropagation();

        selectedColumn = $(this).data('col');

        $('#columnMenu').css({
            top: e.pageY + 5,
            left: e.pageX + 5
        }).show();

        $('#colSearch').val('');
    });

    // Close dropdown on outside click
    $(document).on('click', function () {
        $('#columnMenu').hide();
    });

    // Column search
    $('#colSearch').on('keyup', function () {
        table.column(selectedColumn).search(this.value).draw();
    });

    // Sort ascending
    $('#sortAsc').on('click', function () {
        table.order([selectedColumn, 'asc']).draw();
    });

    // Sort descending
    $('#sortDesc').on('click', function () {
        table.order([selectedColumn, 'desc']).draw();
    });

    // Hide column
    $('#hideCol').on('click', function () {
        table.column(selectedColumn).visible(false);
        $('#columnMenu').hide();
    });

});
</script>
{% endblock js %}
